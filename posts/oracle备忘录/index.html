<!DOCTYPE html>
<html lang="en"><head><title>Oracle备忘录 - iFixedBug.com</title><meta charset="utf-8">
    <meta name="author" content="ifixedbug">
    <meta name="Robots" content="All">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="windows-Target" content="_top">

    

    <link rel="shortcut icon" type="image/x-icon" href="../../logo.svg" />
    <link rel="alt" type="application/rss+xml" href=../../index.xml title="iFixedBug.com" />
    <link rel="stylesheet" href=../../_index.css>

    <link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.css" />
    <link rel="stylesheet" href="https://fonts.loli.net/css2?family=JetBrains+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" />

    
</head><body><div class="LBody" id="start">
        <aside class="LSide"><header class="header">
    <div class="logo-wrap">
        <a class="avatar" href="../../">
            <div class="mask"></div>
            <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
            <img class="avatar" src="../../avatar.png" onerror="this.classList.add('error');this.src='../../img/unknow.svg';">
        </a>
        <a class="title" href="../../">
            <div class="main" ff="title">ifixedbug</div>
            <div class="sub normal cap">赴汤蹈火啊琛哥</div>
            <div class="sub hover cap">毕生终究一无所成。知天命，尽人事。</div>
        </a>
    </div>
    <nav class="menu dis-select"><a class="nav-item active" href="../../">博客</a><a class="nav-item " href="../../docs/">文档</a><a class="nav-item " href="../../search/">搜索</a><a class="nav-item " href="../../about/">关于</a></nav>
</header><div class="widgets"><div class="widget search"><widget class="widget-wrapper search">
    <div class="widget-body">
        <div class="search-wrapper" id="search">
            <div class="search-form">
                <input type="text" class="search-input" id="search-input" placeholder="Search" AUTOCOMPLETE="off" >
                <svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg>
            </div>
        </div>
    </div>
    <script>
        var searchInput = document.getElementById("search-input");
        searchInput.addEventListener('keydown', (event) => {
            var inputValue = encodeURIComponent(searchInput.value.trim());
            if (inputValue && event.keyCode == 13) {
                window.open(`${window.location.protocol}//${window.location.host}/search?key=${inputValue}`);
            }
        });
    </script>
</widget></div><div class="widget toc"><widgets class="widget-wrapper toc">
    <div class="widget-header cap dis-select">
        <a class="name" href="#">Oracle备忘录</a>
    </div>
    <div class="widget-body fs14">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#倒序查询某表的最后100条记录并正序排列">倒序查询某表的最后100条记录，并正序排列</a></li>
    <li><a href="#删除sysdbms_schedulercreate_job创建的日志">删除sys.dbms_scheduler.create_job创建的日志</a></li>
    <li><a href="#分组后只取第一条记录">分组后只取第一条记录</a></li>
    <li><a href="#ora-00936缺失表达式">ora-00936:缺失表达式</a></li>
    <li><a href="#修改oracle的密码永不过期">修改oracle的密码永不过期</a></li>
    <li><a href="#12c开始可以自增id了">12c开始可以自增id了</a></li>
    <li><a href="#session-process与connection的关系">Session Process与Connection的关系</a></li>
    <li><a href="#session占用问题">Session占用问题</a></li>
    <li><a href="#创建sequence和插入时自增trigger">创建Sequence和插入时自增Trigger</a></li>
    <li><a href="#创建只读用户和某些表的同义词">创建只读用户和某些表的同义词</a></li>
    <li><a href="#orcale-要减小精度-修改的列必须为空">orcale 要减小精度 修改的列必须为空</a></li>
    <li><a href="#恢复已经删除的记录">恢复已经删除的记录</a></li>
    <li><a href="#tablespace表空间">TableSpace表空间</a></li>
    <li><a href="#授予用户create-sequence和trigger权限">授予用户create sequence和trigger权限</a></li>
    <li><a href="#oracle执行外部文件">Oracle执行外部文件</a></li>
    <li><a href="#批量创建sequence">批量创建Sequence</a></li>
  </ul>
</nav>
    </div>
</widgets></div><div class="widget recent"><widget class="widget-wrapper recent">
    <div class="widget-header cap theme dis-select">
        <span class="name">最近更新</span>
        <a class="cap-action" id="rss" title="Subscribe" target="_blank" href="../../index.xml">
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8938">
                <path d="M800.966 947.251c0-404.522-320.872-732.448-716.69-732.448V62.785c477.972 0 865.44 395.987 865.44 884.466h-148.75z m-162.273 0h-148.74c0-228.98-181.628-414.598-405.678-414.598v-152.01c306.205 0 554.418 253.68 554.418 566.608z m-446.24-221.12c59.748 0 108.189 49.503 108.189 110.557 0 61.063-48.44 110.563-108.188 110.563-59.747 0-108.18-49.5-108.18-110.563 0-61.054 48.433-110.556 108.18-110.556z" p-id="8939"></path>
            </svg>
        </a>
    </div>
    <div class="widget-body related-posts fs14"><a class="item" href="https://www.ifixedbug.com/posts/%E5%8A%A8%E6%80%81api%E8%AE%BE%E8%AE%A1/"><span class="title">动态api设计文档</span></a><a class="item" href="https://www.ifixedbug.com/posts/linux%E5%A4%87%E5%BF%98%E5%BD%95/"><span class="title">Linux备忘</span></a><a class="item" href="https://www.ifixedbug.com/posts/oracle%E5%A4%87%E5%BF%98%E5%BD%95/"><span class="title">Oracle备忘录</span></a><a class="item" href="https://www.ifixedbug.com/posts/js%E6%9D%82%E9%A1%B9/"><span class="title">JS知识点总结</span></a><a class="item" href="https://www.ifixedbug.com/posts/opu-da%E8%BD%AC%E6%88%90ua%E7%9A%84%E6%96%B9%E6%B3%95/"><span class="title">OPC DA转成OPC UA</span></a></div>
</widget></div></div>
<footer class="footer dis-select">
    <div class="social-wrap"><a class="social" href="https://weibo.com/u/1059010184" target="_blank">
            <img src="../../social/weibo.svg">
        </a><a class="social" href="https://github.com/yuzhigang" target="_blank">
            <img src="../../social/github.svg">
        </a></div>
</footer></aside>
        <main class="LMain"><header class="header mobile-only">
  <div class="logo-wrap">
      <a class="avatar" href="../../">
          <div class="mask"></div>
          <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
          <img class="avatar" src="../../avatar.png" onerror="this.classList.add('error');this.src='../../img/unknow.svg';">
      </a>
      <a class="title" href="../../">
          <div class="main" ff="title">ifixedbug</div>
          <div class="sub normal cap">赴汤蹈火啊琛哥</div>
          <div class="sub hover cap">毕生终究一无所成。知天命，尽人事。</div>
      </a>
  </div>
</header><div class="bread-nav fs14">
  <div class="breadcrumb"><a class="cap item" href="../../categories/%e6%95%b0%e6%8d%ae%e5%ba%93">数据库</a>
      <span class="sep"> </span>
      <span class="sep">|</span><a class="cap item" href="../../tags/dev">dev</a>
      <span class="sep"> </span></div>
  <div class="post-meta">Zigzag 发布于 2024-04-05 12:12:22</div>
</div>

<article class="md-text content post">
  <h1 class="article-title">Oracle备忘录</h1><blockquote class="description">Oracle备忘录，在坑中前行</blockquote><section></section>
<h1 id="#oracle">
    Oracle
    <a class="anchor" name="oracle" href="#oracle">#</a>
</h1>
<section id="#oracle"></section>
<h2 id="#倒序查询某表的最后100条记录并正序排列">
    倒序查询某表的最后100条记录，并正序排列
    <a class="anchor" name="倒序查询某表的最后100条记录并正序排列" href="#%e5%80%92%e5%ba%8f%e6%9f%a5%e8%af%a2%e6%9f%90%e8%a1%a8%e7%9a%84%e6%9c%80%e5%90%8e100%e6%9d%a1%e8%ae%b0%e5%bd%95%e5%b9%b6%e6%ad%a3%e5%ba%8f%e6%8e%92%e5%88%97">#</a>
</h2>
<section id="#倒序查询某表的最后100条记录并正序排列"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">FAC_HEAT_CONSUMPTION</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">rownum</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">HS_CHEMICAL_IRON</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">ONLY</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">id</span></span></span></code></pre></div><p>从0开始，获取100个，OFFSET 0 ROWS可以省略掉。</p>
</section>
<h2 id="#删除sysdbms_schedulercreate_job创建的日志">
    删除sys.dbms_scheduler.create_job创建的日志
    <a class="anchor" name="删除sysdbms_schedulercreate_job创建的日志" href="#%e5%88%a0%e9%99%a4sysdbms_schedulercreate_job%e5%88%9b%e5%bb%ba%e7%9a%84%e6%97%a5%e5%bf%97">#</a>
</h2>
<section id="#删除sysdbms_schedulercreate_job创建的日志"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">begin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">sys</span><span class="p">.</span><span class="n">dbms_scheduler</span><span class="p">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">job_name</span><span class="w">            </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;ARIMSGTEST.UPDATE_PL_JOB&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">job_type</span><span class="w">            </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;STORED_PROCEDURE&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">job_action</span><span class="w">          </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;arimsgtest.update_pl_job&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">start_date</span><span class="w">          </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">to_date</span><span class="p">(</span><span class="k">null</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">repeat_interval</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;Freq=Hourly;Interval=1&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">end_date</span><span class="w">            </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">to_date</span><span class="p">(</span><span class="k">null</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">job_class</span><span class="w">           </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;DEFAULT_JOB_CLASS&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">enabled</span><span class="w">             </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">auto_drop</span><span class="w">           </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="n">comments</span><span class="w">            </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">end</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">User_Scheduler_Jobs</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="err">查看作业</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">All_scheduler_job_log</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">owner</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ARIMSGTEST&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">job_name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UPDATE_PL_JOB2&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">All_scheduler_job_run_details</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">owner</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ARIMSGTEST&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">job_name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UPDATE_PL_JOB2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">all_scheduler_job_run_details</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">owner</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ARIMSGTEST&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">job_name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UPDATE_PL_JOB2&#39;</span></span></span></code></pre></div><p>logging_level——日志记录级别（DBMS_SCHEDULER.LOGGING_OFF，DBMS_SCHEDULER.LOGGING_RUNS，DBMS_SCHEDULER.LOGGING_FULL）<a class="md-link" href="https://blog.csdn.net/Seabiscuit_92/article/details/51038281"  >https://blog.csdn.net/Seabiscuit_92/article/details/51038281<img class="icon" src="../../img/link.svg" /></a>
restartable
max_runs
max_failures</p>
<p>to_date(&lsquo;2004-05-07 13:23:44&rsquo;,&lsquo;yyyy-mm-dd hh24:mi:ss&rsquo;)</p>
</section>
<h2 id="#分组后只取第一条记录">
    分组后只取第一条记录
    <a class="anchor" name="分组后只取第一条记录" href="#%e5%88%86%e7%bb%84%e5%90%8e%e5%8f%aa%e5%8f%96%e7%ac%ac%e4%b8%80%e6%9d%a1%e8%ae%b0%e5%bd%95">#</a>
</h2>
<section id="#分组后只取第一条记录"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="n">rn</span><span class="p">,</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">test1</span><span class="p">.</span><span class="o">*</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">test1</span><span class="p">)</span><span class="w">       
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="p">;</span><span class="w">   </span></span></span></code></pre></div></section>
<h2 id="#ora-00936缺失表达式">
    ora-00936:缺失表达式
    <a class="anchor" name="ora-00936缺失表达式" href="#ora-00936%e7%bc%ba%e5%a4%b1%e8%a1%a8%e8%be%be%e5%bc%8f">#</a>
</h2>
<section id="#ora-00936缺失表达式"><p>当whereExpression为空时，会出现这个问题。基本可以判断是生成的sql语句不标准。在使用sugarsql时注意看下where语句使用。</p>
</section>
<h2 id="#修改oracle的密码永不过期">
    修改oracle的密码永不过期
    <a class="anchor" name="修改oracle的密码永不过期" href="#%e4%bf%ae%e6%94%b9oracle%e7%9a%84%e5%af%86%e7%a0%81%e6%b0%b8%e4%b8%8d%e8%bf%87%e6%9c%9f">#</a>
</h2>
<section id="#修改oracle的密码永不过期"><p>以dba方式登录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"></code></pre></div></section>
<h2 id="#12c开始可以自增id了">
    12c开始可以自增id了
    <a class="anchor" name="12c开始可以自增id了" href="#12c%e5%bc%80%e5%a7%8b%e5%8f%af%e4%bb%a5%e8%87%aa%e5%a2%9eid%e4%ba%86">#</a>
</h2>
<section id="#12c开始可以自增id了"><p>CREATE TABLE identity_test_tab (
id NUMBER GENERATED ALWAYS AS IDENTITY,
description VARCHAR2(30)
);</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$resource_limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$process</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$bgprocess</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">STATUS</span><span class="o">=</span><span class="s1">&#39;ACTIVE&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="n">lockwait</span><span class="p">,</span><span class="n">status</span><span class="p">,</span><span class="n">machine</span><span class="p">,</span><span class="n">program</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">sid</span><span class="w"> </span><span class="k">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">session_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$locked_object</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">sql_text</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$sql</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">hash_value</span><span class="w"> </span><span class="k">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">sql_hash_value</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">sid</span><span class="w"> </span><span class="k">in</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">session_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$locked_object</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="n">l</span><span class="p">.</span><span class="n">OBJECT_ID</span><span class="p">,</span><span class="n">l</span><span class="p">.</span><span class="n">SESSION_ID</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="nb">SERIAL</span><span class="o">#</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">l</span><span class="p">.</span><span class="n">ORACLE_USERNAME</span><span class="p">,</span><span class="n">l</span><span class="p">.</span><span class="n">OS_USER_NAME</span><span class="p">,</span><span class="n">l</span><span class="p">.</span><span class="n">PROCESS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">V$LOCKED_OBJECT</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="n">V$SESSION</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">SESSION_ID</span><span class="o">=</span><span class="n">S</span><span class="p">.</span><span class="n">SID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="n">kill</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="s1">&#39;113,25455&#39;</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$process</span><span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">spid</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">paddr</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="n">addr</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="n">DBMS_SCHEDULER</span><span class="p">.</span><span class="n">STOP_JOB</span><span class="p">(</span><span class="n">job_name</span><span class="w"> </span><span class="o">=&gt;</span><span class="s1">&#39;JOB_INSERT_L2_CCM&#39;</span><span class="p">,</span><span class="k">force</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">TRUE</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$database</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dba_scheduler_running_jobs</span><span class="p">;</span></span></span></code></pre></div><p>— Find the job</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dba_scheduler_running_jobs</span><span class="p">;</span></span></span></code></pre></div><p>— Kill the job:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="n">DBMS_SCHEDULER</span><span class="p">.</span><span class="n">STOP_JOB</span><span class="p">(</span><span class="n">job_name</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;JOB_INSERT_L2_CCM&#39;</span><span class="p">,</span><span class="k">force</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">TRUE</span><span class="p">);</span></span></span></code></pre></div></section>
<h2 id="#session-process与connection的关系">
    Session Process与Connection的关系
    <a class="anchor" name="session-process与connection的关系" href="#session-process%e4%b8%8econnection%e7%9a%84%e5%85%b3%e7%b3%bb">#</a>
</h2>
<section id="#session-process与connection的关系"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$process</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$process</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">paddr</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">sid</span><span class="p">,</span><span class="w"> </span><span class="nb">serial</span><span class="o">#</span><span class="p">,</span><span class="n">username</span><span class="p">,</span><span class="n">program</span><span class="p">,</span><span class="n">machine</span><span class="p">,</span><span class="n">status</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$session</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INACTIVE&#39;</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">machine</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dba_profiles</span></span></span></code></pre></div><p>Connection并不是直接建立在用户进程和数据库实例之间的。而是在用户进程和Server Process（服务器进程）之间的，因此有一个Connection就一定会有一个用户进程和一个服务器进程。但不一定会存在Session。比如，如果需要将东西从A运到B，Connection可以看成是一座“桥”，而卡车把东西从A运到B后并返回A，这就是Session。所以，只要不断开连接，随时都可以在这个连接上创建出会话。</p>
</section>
<h2 id="#session占用问题">
    Session占用问题
    <a class="anchor" name="session占用问题" href="#session%e5%8d%a0%e7%94%a8%e9%97%ae%e9%a2%98">#</a>
</h2>
<section id="#session占用问题"><p>ORA-00054: 资源正忙, 但指定以 NOWAIT 方式获取资源, 或者超时失效：
首先检查是哪个sid，和serial。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">t2</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">sid</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="nb">serial</span><span class="o">#</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">logon_time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">v$locked_object</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="n">v$session</span><span class="w"> </span><span class="n">t2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">t1</span><span class="p">.</span><span class="n">session_id</span><span class="o">=</span><span class="n">t2</span><span class="p">.</span><span class="n">sid</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">t2</span><span class="p">.</span><span class="n">logon_time</span><span class="p">;</span></span></span></code></pre></div><p>然后准备kill掉这个session，假设sid=111，serial=30547</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">alter</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="n">kill</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="s1">&#39;111,30547&#39;</span><span class="p">;</span></span></span></code></pre></div><p>可能出现错误：
ORA-00031：标记要终止的会话 解决方法
则首先执行，查看killed状态的spid，sid和serial：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">spid</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">sid</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="nb">serial</span><span class="o">#</span><span class="p">,</span><span class="n">b</span><span class="p">.</span><span class="n">username</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$process</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">v$session</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">addr</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">paddr</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;KILLED&#39;</span><span class="p">;</span></span></span></code></pre></div><p>准备使用oracle自带的命令删掉这个进程，需要在oracle服务器上执行cmd命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">orakill</span><span class="w">  </span><span class="n">_db</span><span class="w">  </span><span class="n">_spid</span></span></span></code></pre></div><p>其中，_db是通过以下命令获得：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$database</span><span class="p">;</span></span></span></code></pre></div><p>_spid即为上述的spid值。</p>
</section>
<h2 id="#创建sequence和插入时自增trigger">
    创建Sequence和插入时自增Trigger
    <a class="anchor" name="创建sequence和插入时自增trigger" href="#%e5%88%9b%e5%bb%basequence%e5%92%8c%e6%8f%92%e5%85%a5%e6%97%b6%e8%87%aa%e5%a2%9etrigger">#</a>
</h2>
<section id="#创建sequence和插入时自增trigger"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create sequence 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="n">HS_ADDITIVE_SEQ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">minvalue</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">maxvalue</span><span class="w"> </span><span class="mi">999999999999999999999999999</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">increment</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">cache</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span></span></span></code></pre></div><p>创建触发器 HS_ADDITIVE_SEQ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">trigger</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">HS_ADDITIVE_TRG</span><span class="w"> </span><span class="k">BEFORE</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">ON</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">HS_ADDITIVE</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">row</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">begin</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">inserting</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">:</span><span class="k">NEW</span><span class="p">.</span><span class="s2">&#34;ID&#34;</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">then</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">select</span><span class="w"> </span><span class="n">HS_ADDITIVE_SEQ</span><span class="p">.</span><span class="n">nextval</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="p">:</span><span class="k">NEW</span><span class="p">.</span><span class="s2">&#34;ID&#34;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dual</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span><span class="k">end</span><span class="p">;</span></span></span></code></pre></div></section>
<h2 id="#创建只读用户和某些表的同义词">
    创建只读用户和某些表的同义词
    <a class="anchor" name="创建只读用户和某些表的同义词" href="#%e5%88%9b%e5%bb%ba%e5%8f%aa%e8%af%bb%e7%94%a8%e6%88%b7%e5%92%8c%e6%9f%90%e4%ba%9b%e8%a1%a8%e7%9a%84%e5%90%8c%e4%b9%89%e8%af%8d">#</a>
</h2>
<section id="#创建只读用户和某些表的同义词"><p><strong>!注意这是在一个管理员账号下给另一个 用户赋权</strong>
创建视图，并将视图赋予一个用户只读权限，操作步骤如下：
OLDUSER用户具有创建视图的权限。
1）创建用户 zhangsan/zhangsan</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">ems</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ems</span><span class="p">;</span></span></span></code></pre></div><p>2）给zhangsan赋予权限</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">zhangsan</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">OLDUSER</span><span class="p">.</span><span class="n">V_TEST</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">zhangsan</span><span class="p">;</span></span></span></code></pre></div><p>3)使用zhangsan用户登录系统，访问此视图</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">OLDUSER</span><span class="p">.</span><span class="n">V_TEST</span></span></span></code></pre></div><p>4)如果不使用用户名访问，那么需要创建同义词，如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="n">SYNONYM</span><span class="w">  </span><span class="n">zhangsan</span><span class="p">.</span><span class="n">V_TEST</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OLDUSER</span><span class="p">.</span><span class="n">V_TEST</span><span class="p">;</span></span></span></code></pre></div><p>创建同义词之后，在zhangsan登录之后就可以使用如下查询语句了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">V_TEST</span></span></span></code></pre></div></section>
<h2 id="#orcale-要减小精度-修改的列必须为空">
    orcale 要减小精度 修改的列必须为空
    <a class="anchor" name="orcale-要减小精度-修改的列必须为空" href="#orcale-%e8%a6%81%e5%87%8f%e5%b0%8f%e7%b2%be%e5%ba%a6-%e4%bf%ae%e6%94%b9%e7%9a%84%e5%88%97%e5%bf%85%e9%a1%bb%e4%b8%ba%e7%a9%ba">#</a>
</h2>
<section id="#orcale-要减小精度-修改的列必须为空"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="cm">/*修改原字段名name为name_tmp*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">HS_LADLE_HISTORY</span><span class="w"> </span><span class="k">rename</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">IRON_WEIGHT</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">name_tmp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*增加一个和原字段名同名的字段name*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">HS_LADLE_HISTORY</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">IRON_WEIGHT</span><span class="w"> </span><span class="nb">number</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*将原字段name_tmp数据更新到增加的字段name*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">update</span><span class="w"> </span><span class="n">HS_LADLE_HISTORY</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">IRON_WEIGHT</span><span class="o">=</span><span class="n">name_tmp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*更新完，删除原字段name_tmp*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">alter</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">HS_LADLE_HISTORY</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">name_tmp</span><span class="p">;</span></span></span></code></pre></div></section>
<h2 id="#恢复已经删除的记录">
    恢复已经删除的记录
    <a class="anchor" name="恢复已经删除的记录" href="#%e6%81%a2%e5%a4%8d%e5%b7%b2%e7%bb%8f%e5%88%a0%e9%99%a4%e7%9a%84%e8%ae%b0%e5%bd%95">#</a>
</h2>
<section id="#恢复已经删除的记录"><p>ALTER TABLE tableName ENABLE row movement ;
flashback table tableName to timestamp to_timestamp(&lsquo;&lsquo;2011-02-28 10:40:00&rsquo;&rsquo;,&lsquo;&lsquo;yyyy-mm-dd hh24:mi:ss&rsquo;&rsquo;);
后面的参数为要还原的时间点
<a class="md-link" href="https://www.cnblogs.com/chaizp/p/5192522.html"  >https://www.cnblogs.com/chaizp/p/5192522.html<img class="icon" src="../../img/link.svg" /></a></p>
</section>
<h2 id="#tablespace表空间">
    TableSpace表空间
    <a class="anchor" name="tablespace表空间" href="#tablespace%e8%a1%a8%e7%a9%ba%e9%97%b4">#</a>
</h2>
<section id="#tablespace表空间"><p>Oracle数据库是通过表空间来存储物理表的，一个数据库实例可以有N个表空间，一个表空间下可以有N张表。
有了数据库，就可以创建表空间。
表空间(tablespace)是数据库的逻辑划分，每个数据库至少有一个表空间（称作SYSTEM表空间）。为了便于管理和提高运行效率，可以使用一些附加表空间来划分用户和应用程序。例如：USER表空间供一般用户使用，RBS表空间供回滚段使用。一个表空间只能属于一个数据库。
<a class="md-link" href="https://zyjustin9.iteye.com/blog/2193804"  >https://zyjustin9.iteye.com/blog/2193804<img class="icon" src="../../img/link.svg" /></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$database</span><span class="p">;</span><span class="w">    </span><span class="o">//</span><span class="err">查询当前数据库名</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">instance_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">v$instance</span><span class="p">;</span><span class="w">    </span><span class="o">//</span><span class="err">查询当前数据库实例名</span></span></span></code></pre></div><p>Oracle数据库建好后，要想在数据库里建表，必须先为数据库建立用户，并为用户指定表空间。
有了数据库，表空间和用户，就可以用自定义的用户在自己的表空间创建表了。
数据库实例 -&gt; 表空间 -&gt; 创建用户 -&gt; 创建表
<img class="md_img" data-fancybox="gallery" src="https://teakki.top/file/image/5c6e4605b1029f607604555f" alt=""></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="n">DATA_CONFIG</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="cm">/*表空间物理文件名称*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">datafile</span><span class="w"> </span><span class="s1">&#39;data_config.dbf&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">size</span><span class="w"> </span><span class="mi">500</span><span class="n">M</span><span class="w"> </span><span class="n">autoextend</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="mi">5</span><span class="n">M</span><span class="w"> </span><span class="n">maxsize</span><span class="w"> </span><span class="n">unlimited</span><span class="p">;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">arim3</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">arimyfzx</span><span class="w"> </span><span class="c1">--用户密码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="n">DATA_CONFIG</span><span class="c1">-- 表空间是上面创建的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">temporary</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="n">TEMP</span><span class="w"> </span><span class="c1">-- 临时表空间默认 TEMP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="n">profile</span><span class="w"> </span><span class="k">DEFAULT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">--password expire;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">   </span><span class="cm">/*密码过期需要重设密码,意思是当你用这个新建立的密码过期用户首次登录后，系统会提示你重新输入新密码，不然会拒绝你登陆，重设新密码后就可以登录，该用户的密码就是你新设的密码，相当于首次登录修改密码这样的选项。*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="cm">/* 用户授权_1*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">grant</span><span class="w"> </span><span class="k">connect</span><span class="p">,</span><span class="n">resource</span><span class="p">,</span><span class="n">dba</span><span class="p">,</span><span class="k">create</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="p">,</span><span class="k">create</span><span class="w"> </span><span class="k">trigger</span><span class="w">  </span><span class="k">to</span><span class="w"> </span><span class="n">arim3</span><span class="p">;</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">create</span> <span class="n">tablespace</span> <span class="n">lgdd</span> <span class="n">datafile</span> <span class="s1">&#39;lgdd.dbf&#39;</span><span class="n">size</span> <span class="mi">500</span><span class="n">M</span> <span class="n">autoextend</span> <span class="n">on</span> <span class="nb">next</span> <span class="mi">5</span><span class="n">M</span> <span class="n">maxsize</span> <span class="n">unlimited</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">create</span> <span class="n">user</span> <span class="n">arim</span> <span class="n">IDENTIFIED</span> <span class="n">BY</span> <span class="n">arimyfzx</span> <span class="n">default</span> <span class="n">tablespace</span> <span class="n">lgdd</span> <span class="n">temporary</span> <span class="n">tablespace</span> <span class="n">TEMP</span> <span class="n">profile</span> <span class="n">DEFAULT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">grant</span> <span class="n">connect</span><span class="p">,</span><span class="n">resource</span><span class="p">,</span><span class="n">dba</span><span class="p">,</span><span class="n">SEQUENCE</span><span class="p">,</span><span class="n">trigger</span> <span class="n">to</span> <span class="n">arim</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">grant</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">arim</span> <span class="k">with</span> <span class="n">admin</span> <span class="n">option</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">grant</span> <span class="n">dba</span> <span class="n">to</span> <span class="n">arim</span> <span class="k">with</span> <span class="n">admin</span> <span class="n">option</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">grant</span> <span class="n">resource</span> <span class="n">to</span> <span class="n">arim</span> <span class="k">with</span> <span class="n">admin</span> <span class="n">option</span><span class="p">;</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">arim</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">arimyfzx</span><span class="w"> </span><span class="c1">--用户密码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="n">lgdd</span><span class="c1">-- 表空间是上面创建的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="k">temporary</span><span class="w"> </span><span class="n">tablespace</span><span class="w"> </span><span class="n">TEMP</span><span class="w"> </span><span class="c1">-- 临时表空间默认 TEMP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="n">profile</span><span class="w"> </span><span class="k">DEFAULT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">--password expire;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">   </span><span class="cm">/*密码过期需要重设密码,意思是当你用这个新建立的密码过期用户首次登录后，系统会提示你重新输入新密码，不然会拒绝你登陆，重设新密码后就可以登录，该用户的密码就是你新设的密码，相当于首次登录修改密码这样的选项。*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="cm">/* 用户授权_1*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">grant</span><span class="w"> </span><span class="k">connect</span><span class="p">,</span><span class="n">resource</span><span class="p">,</span><span class="n">dba</span><span class="p">,</span><span class="k">create</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="p">,</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">trigger</span><span class="w">  </span><span class="k">to</span><span class="w"> </span><span class="n">arim</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="cm">/* 用户授权_2*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">grant</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">arim</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="k">option</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">grant</span><span class="w"> </span><span class="n">dba</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">arim</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="k">option</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">grant</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">arim</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">admin</span><span class="w"> </span><span class="k">option</span><span class="p">;</span></span></span></code></pre></div></section>
<h2 id="#授予用户create-sequence和trigger权限">
    授予用户create sequence和trigger权限
    <a class="anchor" name="授予用户create-sequence和trigger权限" href="#%e6%8e%88%e4%ba%88%e7%94%a8%e6%88%b7create-sequence%e5%92%8ctrigger%e6%9d%83%e9%99%90">#</a>
</h2>
<section id="#授予用户create-sequence和trigger权限"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">GRANT</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">ARIM</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">grant</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">arim</span><span class="p">;</span></span></span></code></pre></div></section>
<h2 id="#oracle执行外部文件">
    Oracle执行外部文件
    <a class="anchor" name="oracle执行外部文件" href="#oracle%e6%89%a7%e8%a1%8c%e5%a4%96%e9%83%a8%e6%96%87%e4%bb%b6">#</a>
</h2>
<section id="#oracle执行外部文件"><p>c:&gt;sqlplus <a class="md-link" href="https://teakki.topmailto:user/pwd@db"  >user/pwd@db<img class="icon" src="../../img/link.svg" /></a>
sql&gt;@new.sql</p>
</section>
<h2 id="#批量创建sequence">
    批量创建Sequence
    <a class="anchor" name="批量创建sequence" href="#%e6%89%b9%e9%87%8f%e5%88%9b%e5%bb%basequence">#</a>
</h2>
<section id="#批量创建sequence"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="s2">&#34;ADD_SEQ_TRIGGER&#34;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">ctr</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">ctr2</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">addcount</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">totcount</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">var_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">var_seq</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Var_Trg</span><span class="w"> </span><span class="nb">Varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">var_nex</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">begin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_tables</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">LOOP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">ctr</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">user_tab_columns</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="n">var_name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">ctr</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">var_seq</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;_SEQ&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">var_trg</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;_TRG&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">var_nex</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;_SEQ&#39;</span><span class="o">||</span><span class="s1">&#39;.nextval&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">ctr2</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">USER_SEQUENCES</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">sequence_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_seq</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ctr2</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">&#39;sequence exist for table: &#39;</span><span class="o">||</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;!&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">IMMEDIATE</span><span class="w"> </span><span class="s1">&#39;CREATE SEQUENCE &#39;</span><span class="o">||</span><span class="n">var_seq</span><span class="o">||</span><span class="s1">&#39; START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">addcount</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">addcount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">&#39;create or replace trigger for table: &#39;</span><span class="o">||</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;!&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">IMMEDIATE</span><span class="w"> </span><span class="s1">&#39;create or replace trigger &#39;</span><span class="o">||</span><span class="n">var_trg</span><span class="o">||</span><span class="s1">&#39; BEFORE INSERT ON &#39;</span><span class="o">||</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39; for each row begin &#39;</span><span class="o">||</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="s1">&#39;if inserting then if :NEW.&#34;ID&#34; is null then &#39;</span><span class="o">||</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                          </span><span class="s1">&#39;select &#39;</span><span class="o">||</span><span class="n">var_nex</span><span class="o">||</span><span class="s1">&#39; into :NEW.&#34;ID&#34; from dual; end if;end if;end;&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="s1">&#39;ID does NOT exist for table: &#39;</span><span class="o">||</span><span class="n">t</span><span class="p">.</span><span class="k">table_name</span><span class="o">||</span><span class="s1">&#39;!&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">totcount</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">  </span><span class="n">totcount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="n">LOOP</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">&#39;total tables count: &#39;</span><span class="o">||</span><span class="n">totcount</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">DBMS_OUTPUT</span><span class="p">.</span><span class="n">PUT_LINE</span><span class="p">(</span><span class="s1">&#39;total add count: &#39;</span><span class="o">||</span><span class="n">addcount</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w"> </span><span class="n">ADD_SEQ_TRIGGER</span><span class="p">;</span></span></span></code></pre></div></section>
</article>
<script src="https://giscus.app/client.js"
        data-repo="yuzhigang/yuzhigang.github.io"
        data-repo-id="R_kgDOLqDc5Q"
        data-category="Announcements"
        data-category-id="DIC_kwDOLqDc5c4CeeJ5"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script><div class="float-panel mobile-only blur" style="display:none">
  <button type="button" class="sidebar-toggle" onclick="float_panel_click()">
    <svg class="icon" style="width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden"
      viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301">
      <path
        d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z"
        p-id="15302"></path>
      <path
        d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z"
        p-id="15303"></path>
    </svg>
  </button>
  <script>
    float_panel_click = () => {
      document.getElementById("start").classList.toggle("mobile");
      document.getElementsByClassName("sidebar-toggle")[0].classList.toggle("mobile");
    }

    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    
    
  </script>
</div></main>
        
    </div>
</body><script src="../../scripts/tableOfContents.js"></script>

<script type="text/javascript" src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.9/MathJax.js" defer></script>



<script>
    close_float_panel = function(){
        document.getElementById("start").classList.remove("mobile");
    }
</script>
<script src="../../scripts/mathjax.js"></script>
</html>