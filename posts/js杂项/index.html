<!DOCTYPE html>
<html lang="en"><head><title>JS知识点总结 - iFixedBug.com</title><meta charset="utf-8">
    <meta name="author" content="ifixedbug">
    <meta name="Robots" content="All">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="windows-Target" content="_top">

    

    <link rel="shortcut icon" type="image/x-icon" href="../../logo.svg" />
    <link rel="alt" type="application/rss+xml" href=../../index.xml title="iFixedBug.com" />
    <link rel="stylesheet" href=../../_index.css>

    <link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.css" />
    <link rel="stylesheet" href="https://fonts.loli.net/css2?family=JetBrains+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" />

    
</head><body><div class="LBody" id="start">
        <aside class="LSide"><header class="header">
    <div class="logo-wrap">
        <a class="avatar" href="../../">
            <div class="mask"></div>
            <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
            <img class="avatar" src="../../avatar.png" onerror="this.classList.add('error');this.src='../../img/unknow.svg';">
        </a>
        <a class="title" href="../../">
            <div class="main" ff="title">ifixedbug</div>
            <div class="sub normal cap">赴汤蹈火啊琛哥</div>
            <div class="sub hover cap">毕生终究一无所成。知天命，尽人事。</div>
        </a>
    </div>
    <nav class="menu dis-select"><a class="nav-item active" href="../../">博客</a><a class="nav-item " href="../../docs/">文档</a><a class="nav-item " href="../../search/">搜索</a><a class="nav-item " href="../../about/">关于</a></nav>
</header><div class="widgets"><div class="widget search"><widget class="widget-wrapper search">
    <div class="widget-body">
        <div class="search-wrapper" id="search">
            <div class="search-form">
                <input type="text" class="search-input" id="search-input" placeholder="Search" AUTOCOMPLETE="off" >
                <svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg>
            </div>
        </div>
    </div>
    <script>
        var searchInput = document.getElementById("search-input");
        searchInput.addEventListener('keydown', (event) => {
            var inputValue = encodeURIComponent(searchInput.value.trim());
            if (inputValue && event.keyCode == 13) {
                window.open(`${window.location.protocol}//${window.location.host}/search?key=${inputValue}`);
            }
        });
    </script>
</widget></div><div class="widget toc"><widgets class="widget-wrapper toc">
    <div class="widget-header cap dis-select">
        <a class="name" href="#">JS知识点总结</a>
    </div>
    <div class="widget-body fs14">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#移除一个对象的某个属性">移除一个对象的某个属性</a></li>
    <li><a href="#ts项目不识别符号的相对路径设置">ts项目不识别@符号的相对路径设置</a></li>
    <li><a href="#直接运行js字符串代码">直接运行js字符串代码</a></li>
    <li><a href="#通过function-name调用function">通过function name调用function</a></li>
  </ul>

  <ul>
    <li><a href="#path">path</a></li>
    <li><a href="#getbbox-获取对象的矩阵对象">getBBox() 获取对象的矩阵对象</a></li>
  </ul>

  <ul>
    <li><a href="#基础知识-1">基础知识</a></li>
    <li><a href="#模型解释">模型解释</a></li>
  </ul>

  <ul>
    <li><a href="#usecontext">useContext</a></li>
    <li><a href="#避免重新渲染的技巧">避免重新渲染的技巧</a></li>
    <li><a href="#reactmemo的用途">React.memo的用途</a></li>
    <li><a href="#reactmemo-与-usememo的区别">React.memo 与 useMemo的区别</a></li>
    <li><a href="#触发组件重新渲染的技巧">触发组件重新渲染的技巧</a></li>
  </ul>

  <ul>
    <li><a href="#发布npm命令">发布npm命令</a></li>
    <li><a href="#npm的相对地址和绝对地址">npm的相对地址和绝对地址</a></li>
  </ul>

  <ul>
    <li><a href="#gitignore重新添加">gitignore重新添加</a></li>
  </ul>
</nav>
    </div>
</widgets></div></div>
<footer class="footer dis-select">
    <div class="social-wrap"><a class="social" href="https://weibo.com/u/1059010184" target="_blank">
            <img src="../../social/weibo.svg">
        </a><a class="social" href="https://github.com/yuzhigang" target="_blank">
            <img src="../../social/github.svg">
        </a></div>
</footer></aside>
        <main class="LMain"><header class="header mobile-only">
  <div class="logo-wrap">
      <a class="avatar" href="../../">
          <div class="mask"></div>
          <div class="bg" style="background-image:url(/img/rainbow64@3x.webp)"></div>
          <img class="avatar" src="../../avatar.png" onerror="this.classList.add('error');this.src='../../img/unknow.svg';">
      </a>
      <a class="title" href="../../">
          <div class="main" ff="title">ifixedbug</div>
          <div class="sub normal cap">赴汤蹈火啊琛哥</div>
          <div class="sub hover cap">毕生终究一无所成。知天命，尽人事。</div>
      </a>
  </div>
</header><div class="bread-nav fs14">
  <div class="breadcrumb"><a class="cap item" href="../../categories/js">JS</a>
      <span class="sep"> </span>
      <span class="sep">|</span><a class="cap item" href="../../tags/dev">dev</a>
      <span class="sep"> </span></div>
  <div class="post-meta">Zigzag 发布于 2024-03-05 12:12:22</div>
</div>

<article class="md-text content post">
  <h1 class="article-title">JS知识点总结</h1><blockquote class="description">JS知识点总结</blockquote><section></section>
<h1 id="#基础知识">
    基础知识
    <a class="anchor" name="基础知识" href="#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86">#</a>
</h1>
<section id="#基础知识"></section>
<h2 id="#移除一个对象的某个属性">
    移除一个对象的某个属性
    <a class="anchor" name="移除一个对象的某个属性" href="#%e7%a7%bb%e9%99%a4%e4%b8%80%e4%b8%aa%e5%af%b9%e8%b1%a1%e7%9a%84%e6%9f%90%e4%b8%aa%e5%b1%9e%e6%80%a7">#</a>
</h2>
<section id="#移除一个对象的某个属性"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"> <span class="kr">const</span> <span class="nx">removeProperty</span> <span class="o">=</span> <span class="p">(</span><span class="nx">propKey</span><span class="p">,</span> <span class="p">{</span> <span class="p">[</span><span class="nx">propKey</span><span class="p">]</span><span class="o">:</span> <span class="nx">propValue</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="nx">rest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="nx">object</span> <span class="o">=</span> <span class="nx">removeProperty</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nx">object</span><span class="p">);</span></span></span></code></pre></div><p><a class="md-link" href="https://stackoverflow.com/questions/208105/how-do-i-remove-a-property-from-a-javascript-object/52301527#52301527"  >https://stackoverflow.com/questions/208105/how-do-i-remove-a-property-from-a-javascript-object/52301527#52301527<img class="icon" src="../../img/link.svg" /></a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install -g cnpm --registry<span class="o">=</span>https://registry.npmmirror.com</span></span></code></pre></div><pre tabindex="0"><code>npm install -g nrm
nrm ls
nrm use taobao
// 注意npm publish 到 npm官方站点后记得切换到官方源，否则看不到最新的版本

// 旧地址2022年(今年)5月份停止解析
npm config set registry http://registry.npmmirror.com</code></pre></section>
<h2 id="#ts项目不识别符号的相对路径设置">
    ts项目不识别@符号的相对路径设置
    <a class="anchor" name="ts项目不识别符号的相对路径设置" href="#ts%e9%a1%b9%e7%9b%ae%e4%b8%8d%e8%af%86%e5%88%ab%e7%ac%a6%e5%8f%b7%e7%9a%84%e7%9b%b8%e5%af%b9%e8%b7%af%e5%be%84%e8%ae%be%e7%bd%ae">#</a>
</h2>
<section id="#ts项目不识别符号的相对路径设置"><p>在tsconfig.json 或者jsconfig.json中，配置 compilerOptions 的路径，加入：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;paths&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;@/*&#34;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&#34;./src/*&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></section>
<h2 id="#直接运行js字符串代码">
    直接运行js字符串代码
    <a class="anchor" name="直接运行js字符串代码" href="#%e7%9b%b4%e6%8e%a5%e8%bf%90%e8%a1%8cjs%e5%ad%97%e7%ac%a6%e4%b8%b2%e4%bb%a3%e7%a0%81">#</a>
</h2>
<section id="#直接运行js字符串代码"><p>引用： <a class="md-link" href="https://stackoverflow.com/questions/939326/execute-javascript-code-stored-as-a-string"  >https://stackoverflow.com/questions/939326/execute-javascript-code-stored-as-a-string<img class="icon" src="../../img/link.svg" /></a></p>
<ul>
<li>方法一：使用 Function，注意：如何为Function添加参数？</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//Executes immediately
</span></span></span><span class="line"><span class="cl"><span class="c1">// 注意使用return， 不然没有返回值。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">stringToFunctionAndExecute</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">func</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="nx">func</span><span class="p">());</span> <span class="c1">// &lt;--- note the parenteces
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Executes when called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">stringToFunctionOnly</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">func</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">func</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 有参数的Function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">func</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span> <span class="p">([</span><span class="nx">arg1</span><span class="p">[,</span> <span class="nx">arg2</span><span class="p">[,</span> <span class="p">...</span><span class="nx">argN</span><span class="p">]],]</span> <span class="nx">functionBody</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;console.log(name)&#34;</span><span class="p">);</span></span></span></code></pre></div><ul>
<li>方法二： 添加js脚本头</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">executeScript</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;script&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&#34;data:text/plain;base64,&#34;</span> <span class="o">+</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">executeScript</span><span class="p">(</span><span class="s2">&#34;alert(&#39;Hello, World!&#39;);&#34;</span><span class="p">);</span></span></span></code></pre></div><ul>
<li>方法三： 提前定义好函数，传递 函数名字符串进入系统运行：</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runMe</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">z</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// function name and parameters to pass
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">fnstring</span> <span class="o">=</span> <span class="s2">&#34;runMe&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fnparams</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span><span class="c1">//&lt;--parameters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// find object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nx">fnstring</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// is object a function?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fn</span> <span class="o">===</span> <span class="s2">&#34;function&#34;</span><span class="p">)</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">fnparams</span><span class="p">);</span><span class="c1">//&lt;--apply parameter
</span></span></span></code></pre></div><ul>
<li>方法四： 使用setTimeout方法</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"> <span class="kd">function</span> <span class="nx">ExecStr</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="nx">InterVal</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="nx">F</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span> <span class="nx">InterVal</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//sample
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ExecStr</span><span class="p">(</span><span class="s2">&#34;alert(20)&#34;</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span></span></span></code></pre></div><ul>
<li>方法五： 使用math.js库，具有解析能力
引用： <a class="md-link" href="https://mathjs.org/docs/expressions/parsing.html#evaluate"  >https://mathjs.org/docs/expressions/parsing.html#evaluate<img class="icon" src="../../img/link.svg" /></a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">math</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="s1">&#39;sqrt(3^2 + 4^2)&#39;</span><span class="p">)</span>        <span class="c1">// 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">math</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="s1">&#39;sqrt(-4)&#39;</span><span class="p">)</span>               <span class="c1">// 2i
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">math</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="s1">&#39;2 inch to cm&#39;</span><span class="p">)</span>  
</span></span></code></pre></div></section>
<h2 id="#通过function-name调用function">
    通过function name调用function
    <a class="anchor" name="通过function-name调用function" href="#%e9%80%9a%e8%bf%87function-name%e8%b0%83%e7%94%a8function">#</a>
</h2>
<section id="#通过function-name调用function"><p><a class="md-link" href="https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string"  >https://stackoverflow.com/questions/359788/how-to-execute-a-javascript-function-when-i-have-its-name-as-a-string<img class="icon" src="../../img/link.svg" /></a></p>
<p>事先在全局环境定义好一个 function，然后在仅知道该function 名称的情况下调用它。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// context在浏览器内则指代 window 对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">executeFunctionByName</span><span class="p">(</span><span class="nx">functionName</span><span class="p">,</span> <span class="nx">context</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">namespaces</span> <span class="o">=</span> <span class="nx">functionName</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">namespaces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">[</span><span class="nx">namespaces</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">context</span><span class="p">[</span><span class="nx">func</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Converts a string containing a function or object method name to a function pointer.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param  string   func
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return function
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getFuncFromString</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// if already a function, return
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">func</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">func</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// if string, try to find function or method of object (of &#34;obj.func&#34; format)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">func</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">func</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">ns</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// return null if could not parse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// https://juejin.cn/post/7078532391832125448
</span></span></span><span class="line"><span class="cl"><span class="c1">// 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getPercentWithPrecision</span><span class="p">(</span><span class="nx">valueList</span><span class="p">,</span> <span class="nx">precision</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 根据保留的小数位做对应的放大
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">digits</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">precision</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">total</span><span class="p">,</span> <span class="nx">cur</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">total</span> <span class="o">+</span> <span class="nx">cur</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// 计算每项占比，并做放大，保证整数部分就是当前获得的席位，小数部分就是余额
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">votesPerQuota</span> <span class="o">=</span> <span class="nx">valueList</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">val</span> <span class="o">/</span> <span class="nx">sum</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="nx">digits</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 整数部分就是每项首次分配的席位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">seats</span> <span class="o">=</span> <span class="nx">votesPerQuota</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 计算各项的余额
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">remainder</span> <span class="o">=</span> <span class="nx">votesPerQuota</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">val</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="c1">// 总席位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">totalSeats</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nx">digits</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 当前已经分配出去的席位总数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">currentSeats</span> <span class="o">=</span> <span class="nx">votesPerQuota</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">total</span><span class="p">,</span> <span class="nx">cur</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">total</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">cur</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="c1">// 按最大余额法分配
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span><span class="p">(</span><span class="nx">totalSeats</span> <span class="o">-</span> <span class="nx">currentSeats</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">maxIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">// 余数最大的 id
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="nx">maxValue</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">NEGATIVE_INFINITY</span> <span class="c1">// 最大余额, 初始重置为无穷小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 选出这组余额数据中最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">remainder</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">maxValue</span> <span class="o">&lt;</span> <span class="nx">remainder</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxValue</span> <span class="o">=</span> <span class="nx">remainder</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nx">maxIdx</span> <span class="o">=</span> <span class="nx">i</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1">// 对应的项席位加 1，余额清零，当前分配席位加 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">seats</span><span class="p">[</span><span class="nx">maxIdx</span><span class="p">]</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">    <span class="nx">remainder</span><span class="p">[</span><span class="nx">maxIdx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="nx">currentSeats</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">seats</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="sb">`</span><span class="si">${</span><span class="nx">val</span> <span class="o">/</span> <span class="nx">totalSeats</span> <span class="o">*</span> <span class="mi">100</span><span class="si">}</span><span class="sb">%`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 限制异步并发这个功能也很常见，如果同时发出一堆请求，网络可能就被这一堆请求占用了，其他请求就会排在后边，所以我们想限制下请求的并发数。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">async</span> <span class="kd">function</span> <span class="nx">asyncPool</span><span class="p">(</span><span class="nx">poolLimit</span><span class="p">,</span> <span class="nx">iterable</span><span class="p">,</span> <span class="nx">iteratorFn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 用于保存所有异步请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 用户保存正在进行的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">executing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">iterable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 构造出请求 Promise
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">iteratorFn</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">iterable</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">executing</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 请求执行结束后从正在进行的数组中移除
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">clean</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">executing</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">clean</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">clean</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 如果正在执行的请求数大于并发数，就使用 Promise.race 等待一个最快执行完的请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">executing</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;=</span> <span class="nx">poolLimit</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">(</span><span class="nx">executing</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 返回所有结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">i</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="p">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">asyncPool</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span> <span class="nx">timeout</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">results</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div></section>
<h1 id="#svg基础知识">
    SVG基础知识
    <a class="anchor" name="svg基础知识" href="#svg%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86">#</a>
</h1>
<section id="#svg基础知识"></section>
<h2 id="#path">
    path
    <a class="anchor" name="path" href="#path">#</a>
</h2>
<section id="#path"><p>元素用于定义一个路径。 下面的命令可用于路径数据：</p>
<ul>
<li>M = moveto</li>
<li>L = lineto</li>
<li>H = horizontal lineto</li>
<li>V = vertical lineto</li>
<li>C = curveto</li>
<li>S = smooth curveto</li>
<li>Q = quadratic Bézier curve</li>
<li>T = smooth quadratic Bézier curveto</li>
<li>A = elliptical Arc</li>
<li>Z = closepath
注意：以上所有命令均允许小写字母。大写表示绝对定位，小写表示相对定位。
如何绘制一个线条并在其上写字？</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"> <span class="p">&lt;</span><span class="nt">svg</span> <span class="na">viewBox</span><span class="o">=</span><span class="s">&#34;0 0 500 500&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">path</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;curve&#34;</span> <span class="na">d</span><span class="o">=</span><span class="s">&#34;M 0 150 h 200&#34;</span> <span class="na">stroke</span><span class="o">=</span><span class="s">&#34;#0ff&#34;</span> <span class="na">stroke-width</span><span class="o">=</span><span class="s">&#34;1px&#34;</span> <span class="na">fill</span><span class="o">=</span><span class="s">&#34;none&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">text</span> <span class="na">dy</span><span class="o">=</span><span class="s">&#34;15&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">textPath</span> <span class="na">startOffset</span><span class="o">=</span><span class="s">&#34;50%&#34;</span> <span class="na">text-anchor</span><span class="o">=</span><span class="s">&#34;middle&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#curve&#34;</span> <span class="na">side</span><span class="o">=</span><span class="s">&#34;left&#34;</span><span class="p">&gt;</span>13&#39;<span class="p">&lt;/</span><span class="nt">textPath</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">text</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span></span></span></code></pre></div><p>其中的dy能控制文本的位置， text-anchor 是指文字水平位置。 先居中，然后根据文字长度左移一半的长度。</p>
</section>
<h2 id="#getbbox-获取对象的矩阵对象">
    getBBox() 获取对象的矩阵对象
    <a class="anchor" name="getbbox-获取对象的矩阵对象" href="#getbbox-%e8%8e%b7%e5%8f%96%e5%af%b9%e8%b1%a1%e7%9a%84%e7%9f%a9%e9%98%b5%e5%af%b9%e8%b1%a1">#</a>
</h2>
<section id="#getbbox-获取对象的矩阵对象"><p>getBBox方法返回一个包含svg元素的最小矩形的坐标对象。坐标的位置相对于svg元素的原点，且不受任何transform变换的影响。对于测量text文本元素的宽度、高度很有用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">svgText</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">svgText</span><span class="p">.</span><span class="nx">getBBox</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 如下
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">x</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">y</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">width</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">height</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// __proto__: SVGRect
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div></section>
<h1 id="#dvajs">
    DvaJS
    <a class="anchor" name="dvajs" href="#dvajs">#</a>
</h1>
<section id="#dvajs"></section>
<h2 id="#基础知识-1">
    基础知识
    <a class="anchor" name="基础知识-1" href="#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86-1">#</a>
</h2>
<section id="#基础知识-1"><p>从 <code>state</code> 树中读取部分数据，并通过 props 来把这些数据提供给要渲染的组件。其中<code>connect</code> 是一个函数，绑定 State 到 View，实现了为组件传递props。</p>
<p>注意这个<code>state</code>参数的数据来源， 它是 整个项目注册的modelTypde的字典集合，key就是model实例的namespace</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;dva&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 注意这个state参数的来源， 它是 整个项目注册的modelTypde的字典集合，key就是model实例的namespace。
</span></span></span><span class="line"><span class="cl"><span class="c1">// 它会注入全部的models，你需要返回一个新的对象构成链接组件的props。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">mapStateToProps</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span> <span class="nx">todos</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 把todos作为App组件的props，传递给App组件。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">wrappedApp</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">App</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// wrappedApp被称为 容器组件， 因为它是原始 UI 组件的容器，即在外面包了一层 State而已。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 被 connect 的 容器组件 会自动在 props 中拥有 dispatch 方法，可在组件里使用： 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">dispatch</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;click-submit-button&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">payload</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">data</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div></section>
<h2 id="#模型解释">
    模型解释
    <a class="anchor" name="模型解释" href="#%e6%a8%a1%e5%9e%8b%e8%a7%a3%e9%87%8a">#</a>
</h2>
<section id="#模型解释"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Effect</span><span class="p">,</span> <span class="nx">Reducer</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;umi&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ActivitiesType</span><span class="p">,</span> <span class="nx">CurrentUser</span><span class="p">,</span> <span class="nx">NoticeType</span><span class="p">,</span> <span class="nx">RadarDataType</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./data.d&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">fakeChartData</span><span class="p">,</span> <span class="nx">queryActivities</span><span class="p">,</span> <span class="nx">queryCurrent</span><span class="p">,</span> <span class="nx">queryProjectNotice</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;./service&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 模型状态定义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ModalState</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentUser?</span>: <span class="kt">CurrentUser</span>
</span></span><span class="line"><span class="cl">  <span class="nx">projectNotice</span>: <span class="kt">NoticeType</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">activities</span>: <span class="kt">ActivitiesType</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">radarData</span>: <span class="kt">RadarDataType</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Model模型定义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ModelType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">namespace</span><span class="o">:</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span>: <span class="kt">ModalState</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reducers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">save</span>: <span class="kt">Reducer</span><span class="p">&lt;</span><span class="nt">ModalState</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clear</span>: <span class="kt">Reducer</span><span class="p">&lt;</span><span class="nt">ModalState</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">effects</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">init</span>: <span class="kt">Effect</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchUserCurrent</span>: <span class="kt">Effect</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchProjectNotice</span>: <span class="kt">Effect</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchActivitiesList</span>: <span class="kt">Effect</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetchChart</span>: <span class="kt">Effect</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 创建一个新的 Model，umi会自动注册？ 对，plugin-dva会自动遍历： model.ts
</span></span></span><span class="line"><span class="cl"><span class="c1">// 约定的目录： https://umijs.org/zh-CN/plugins/plugin-dva
</span></span></span><span class="line"><span class="cl"><span class="c1">// 各种plugin的配置在 config/config.ts 中，
</span></span></span><span class="line"><span class="cl"><span class="c1">// dva: {
</span></span></span><span class="line"><span class="cl"><span class="c1">//    immer: true, // 是否启用 immer 以方便修改 reducer
</span></span></span><span class="line"><span class="cl"><span class="c1">//    hmr: false, // 是否启用 dva model 的热更新
</span></span></span><span class="line"><span class="cl"><span class="c1">//  },
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">Model</span>: <span class="kt">ModelType</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">namespace</span><span class="o">:</span> <span class="s1">&#39;dashboardAndworkplace&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">currentUser</span>: <span class="kt">undefined</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">projectNotice</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">    <span class="nx">activities</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">    <span class="nx">radarData</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">effects</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// 计算以外的操作都属于 Effect，典型的就是 I/O 操作、数据库读写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="c1">// Effect 是一个 Generator 函数，内部使用 yield 关键字，标识每一步的操作（不管是异步或同步）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="c1">// call：执行异步函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="c1">// put：发出一个 Action，类似于 dispatch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// select： 从 state 里获取数据。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// _ 是action，因为没用到， 变成了占位符。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="nx">init</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">put</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;fetchUserCurrent&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;fetchProjectNotice&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;fetchActivitiesList&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span> <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;fetchChart&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">fetchUserCurrent</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">put</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">queryCurrent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">currentUser</span>: <span class="kt">response</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">fetchProjectNotice</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">put</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">queryProjectNotice</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">projectNotice</span>: <span class="kt">Array.isArray</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">?</span> <span class="nx">response</span> <span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">fetchActivitiesList</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">put</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">queryActivities</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">activities</span>: <span class="kt">Array.isArray</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">?</span> <span class="nx">response</span> <span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">fetchChart</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">call</span><span class="p">,</span> <span class="nx">put</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">radarData</span> <span class="p">}</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fakeChartData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">yield</span> <span class="nx">put</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">radarData</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reducers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">save</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="p">{</span> <span class="nx">payload</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 启用 immer 之后
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// save(state, action) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//   state.name = action.payload;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// },
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clear() {</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">currentUser</span>: <span class="kt">undefined</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">projectNotice</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">activities</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">radarData</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span></span></span></code></pre></div></section>
<h1 id="#react">
    React
    <a class="anchor" name="react" href="#react">#</a>
</h1>
<section id="#react"></section>
<h2 id="#usecontext">
    useContext
    <a class="anchor" name="usecontext" href="#usecontext">#</a>
</h2>
<section id="#usecontext"><p>父组件传递给孙子组件的props或state，需要层层传递，非常麻烦，如果是公用的数据，如何做到一步到位？即孙组件可以直接访问当顶层的props。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 首先在组件外部声明一个Context，等待引用。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">React</span> <span class="kr">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ThemeContext</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">ThemeContext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 然后在父组件中引用一个已声明的Context，并包含了一些值。CC1组件里还有孙子组件。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">&lt;</span><span class="nt">ThemeContext.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">count</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="p">&lt;</span><span class="nt">ContextComponent1</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">ThemeContext.Provider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 最后：孙组件可以使用useContext直接获取到value值。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">ThemeContext</span> <span class="kr">from</span> <span class="s1">&#39;./ThemeContext&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ContextComponent</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">useContext</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>注意： 使用 useContext的组件，即使memo了，只要context的value发生变化，组件的重新渲染总是发生（useState, useReducer等也是如此）。那该怎么消除某些时候不必要的渲染呢？</p>
<ul>
<li>推荐：将Context分割成不同用途的小Context，分配的原则是看 哪些数据是经常变化的，哪些是不常变化的。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">themes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">light</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">foreground</span><span class="o">:</span> <span class="s2">&#34;#000000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">background</span><span class="o">:</span> <span class="s2">&#34;#eeeeee&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dark</span><span class="o">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 分割成不同context，根据变化频度分割。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">ThemeContext</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">(</span><span class="nx">themes</span><span class="p">.</span><span class="nx">light</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">AppContext</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createContext</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">appContextValue</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AppContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">themeContextValue</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 对于button组件来说，只用到theme的值， 这个值不是经常变化的，所以button组件很少重新渲染。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">Button() {</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// The rest of your rendering logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">ExpensiveTree</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ExpensiveTree() {</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// The rest of your rendering logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><ul>
<li>把一个组件分成两部分，内组件和外部组件。外部组件总是渲染，但是渲染开销比较小。内部组件不渲染，尽管它的渲染开销大。避免了开销大的渲染。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// AppContext的变化会引起Button的重新渲染，但是它的渲染开销小，因为内部组件的props可能并没有变化，memo后就无需重新渲染了。
</span></span></span><span class="line"><span class="cl"><span class="c1">// 这是个外部组件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">Button() {</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">appContextValue</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AppContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">appContextValue</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span> <span class="c1">// Your &#34;selector&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">ThemedButton</span> <span class="na">theme</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这是个渲染开销大的内部组件，但是用memo后，与Context没有任何关联，Context的变化不会引起它的重新渲染，它只关心具体的theme值是否变化。
</span></span></span><span class="line"><span class="cl"><span class="c1">// 这是个内部组件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">ThemedButton</span> <span class="o">=</span> <span class="nx">memo</span><span class="p">(({</span> <span class="nx">theme</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">/// 这个方法的不方便之处在于：内部组件依然需要定义复杂的props，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// 如果是个普通的组件函数，则可以直接使用 theme
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">ExpensiveTree</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span></span></span></code></pre></div><ul>
<li>使用useMemo，返回一个包装的内部组件，本质和上面的方法一样，不过更简单。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">Button() {</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">appContextValue</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AppContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">appContextValue</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span> <span class="c1">// Your &#34;selector&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// 整个组件依然会被重新渲染，但是由于使用了useMemo，会查看它的依赖 theme 值是否发生了变化，如没有，则会立刻返回。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// The rest of your rendering logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 这个方法的不方便之处在于：内部组件依然需要定义复杂的props，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 如果是个普通的组件函数，则可以直接使用 theme
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">ExpensiveTree</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">theme</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></section>
<h2 id="#避免重新渲染的技巧">
    避免重新渲染的技巧
    <a class="anchor" name="避免重新渲染的技巧" href="#%e9%81%bf%e5%85%8d%e9%87%8d%e6%96%b0%e6%b8%b2%e6%9f%93%e7%9a%84%e6%8a%80%e5%b7%a7">#</a>
</h2>
<section id="#避免重新渲染的技巧"><p>如上所述，当一个组件里的 context、state、reducer等发生变化时，组件一定会触发重新渲染。但有些渲染是无意义的，因为不涉及组件props的变化。原则上只有组件的props的具体值（不仅仅是其props引用）发生变化再去渲染才是有意义的。而<strong>不是预期的</strong>组件内部或外部的动作引起的状态变化，重新渲染一般是无意义的。避免重新渲染的方法有：</p>
<ul>
<li>使用useMemo，返回一个包装的内部组件。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">Button() {</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 若以下语句总是引起渲染
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">appContextValue</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">AppContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">theme</span> <span class="o">=</span> <span class="nx">appContextValue</span><span class="p">.</span><span class="nx">theme</span><span class="p">;</span> <span class="c1">// Your &#34;selector&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">// 整个组件依然会被重新渲染，但是由于使用了useMemo，会查看它的依赖 theme 值是否发生了变化，如没有，则会立刻返回。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// The rest of your rendering logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">ExpensiveTree</span> <span class="na">className</span><span class="o">=</span><span class="p">{</span><span class="nx">theme</span><span class="p">}</span> <span class="p">/&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="p">[</span><span class="nx">theme</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>一个通用的HOC（高阶组件）方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">withContext</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mapState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mapDispatchers</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">WrapperComponent</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">EnhancedComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">targetContext</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="p">...</span><span class="nx">statePointers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">mapState</span><span class="p">(</span><span class="nx">targetContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="p">...</span><span class="nx">dispatchPointers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">mapDispatchers</span><span class="p">(</span><span class="nx">targetContext</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">useMemo</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">WrapperComponent</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="p">{...</span><span class="nx">statePointers</span><span class="p">}</span> <span class="p">{...</span><span class="nx">dispatchPointers</span><span class="p">}</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">statePointers</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">props</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">dispatchPointers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">EnhancedComponent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 具体的使用方法：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">mapActions</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">mapState</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">theme</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span> <span class="o">&amp;&amp;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">theme</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 导出了包装后的高阶组件。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">connectContext</span><span class="p">(</span><span class="nx">ThemeContext</span><span class="p">,</span> <span class="nx">mapState</span><span class="p">,</span> <span class="nx">mapActions</span><span class="p">)(</span><span class="nx">Button</span><span class="p">);</span></span></span></code></pre></div><ul>
<li>将内部组件作为props传入组件中。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// 该组件总是渲染时， 内部的Logger也需要重新创建一次，故每次渲染都是一个新的实例。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">Counter</span><span class="p">(</span><span class="nx">props</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span>	
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">Logger</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;counter&#34;</span><span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 该组件总是被渲染，但是因为可能传递的是同一个logger， 所以logger本身并不会重新创建，使用的是同一个实例。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">Counter</span><span class="p">({</span><span class="nx">logger</span><span class="p">}){</span><span class="k">return</span> <span class="p">(</span>	<span class="p">{</span><span class="nx">logger</span><span class="p">})}</span></span></span></code></pre></div></section>
<h2 id="#reactmemo的用途">
    React.memo的用途
    <a class="anchor" name="reactmemo的用途" href="#reactmemo%e7%9a%84%e7%94%a8%e9%80%94">#</a>
</h2>
<section id="#reactmemo的用途"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* 使用 props 渲染 */</span><span class="p">});</span></span></span></code></pre></div><p>相同 props 的情况下渲染相同的结果，则不会再次渲染，提高性能。但是React.memo 仅<strong>检查 props 变更，且是浅层对比</strong>，如果函数组件被 React.memo 包裹，且其实现中拥有 useState，useReducer 或 useContext 的 Hook，当 context （app state）发生变化时，它仍会重新渲染。</p>
<p>以下演示使用第二个函数来判断是否重新渲染。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// 以下演示使用第二个函数来判断是否重新渲染。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl"><span class="cm">/* 使用 props 渲染 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">areEqual</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">,</span> <span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/*  如果把 nextProps 传入 render 方法的返回结果与  将 prevProps 传入 render 方法的返回结果一致则返回 true，  否则返回 false  */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">MyComponent</span><span class="p">,</span> <span class="nx">areEqual</span><span class="p">);</span></span></span></code></pre></div></section>
<h2 id="#reactmemo-与-usememo的区别">
    React.memo 与 useMemo的区别
    <a class="anchor" name="reactmemo-与-usememo的区别" href="#reactmemo-%e4%b8%8e-usememo%e7%9a%84%e5%8c%ba%e5%88%ab">#</a>
</h2>
<section id="#reactmemo-与-usememo的区别"><p>React.memo 相当于 类组件的 PureComponent， 它通过比较组件的props是否已改变，来决定是否需要重新调用 render方法或者 函数组件自身。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ThemedButton</span> <span class="o">=</span> <span class="nx">memo</span><span class="p">(({</span> <span class="nx">props</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// props对象尽可能是简单对象， 这样可以充分利用memo自带的浅比较机制  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// 如果props的对象有复杂的引用对象， 则引用相同不会重绘。  		 return &lt;ExpensiveTree {...props} /&gt;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span></span></span></code></pre></div><p>useMemo  只能用在函数组件的内部，可以将子组件包裹起来。 函数组件本身总是被渲染的，这与react.memo是不同的。 只是 use Memo包裹的子组件根据依赖，来决定是否重新渲染其<strong>子组件</strong>。</p>
<p>一句话总结： react.memo后的组件，可以减少<strong>自身</strong>被父组件重复渲染；useMemo包裹后的子组件，可以减少<strong>子组件</strong>的渲染，但自身可能总是被渲染。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">Button() {</span>  <span class="c1">// 若以下语句总是引起渲染  let appContextValue = useContext(AppContext);  let theme = appContextValue.theme; // Your &#34;selector&#34; // 整个组件依然会被重新渲染，但是由于使用了useMemo，会查看它的依赖 theme 值是否发生了变化，如没有，则会立刻返回。  return useMemo(() =&gt; {    // The rest of your rendering logic    return &lt;ExpensiveTree className={theme} /&gt;;  }, [theme])}
</span></span></span></code></pre></div></section>
<h2 id="#触发组件重新渲染的技巧">
    触发组件重新渲染的技巧
    <a class="anchor" name="触发组件重新渲染的技巧" href="#%e8%a7%a6%e5%8f%91%e7%bb%84%e4%bb%b6%e9%87%8d%e6%96%b0%e6%b8%b2%e6%9f%93%e7%9a%84%e6%8a%80%e5%b7%a7">#</a>
</h2>
<section id="#触发组件重新渲染的技巧"><p>组件的props是个复杂深层次的对象，对象的引用本身不变，则对象属性改变不会触发更新。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>  <span class="nx">user</span><span class="o">:</span><span class="p">{</span>  	<span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Tom&#39;</span><span class="p">,</span>  	<span class="nx">age</span>: <span class="kt">18</span>  <span class="p">}}</span></span></span></code></pre></div><p>props.user.name = &lsquo;Bob&rsquo; 并不会触发组件更新。</p>
</section>
<h1 id="#nodejs">
    nodeJs
    <a class="anchor" name="nodejs" href="#nodejs">#</a>
</h1>
<section id="#nodejs"></section>
<h2 id="#发布npm命令">
    发布npm命令
    <a class="anchor" name="发布npm命令" href="#%e5%8f%91%e5%b8%83npm%e5%91%bd%e4%bb%a4">#</a>
</h2>
<section id="#发布npm命令"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm publish
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">npm install -g nrm
</span></span><span class="line"><span class="cl">nrm ls
</span></span><span class="line"><span class="cl">nrm use taobao
</span></span><span class="line"><span class="cl">// 注意npm publish 到 npm官方站点后记得切换到官方源，否则看不到最新的版本</span></span></code></pre></div><p>保证npm的name和version不能都一样。（记得编辑version的版本和登录 npm login) yuzhigang/yu5460zhigang</p>
<p><a class="md-link" href="https://www.npmjs.com/package/swagger-code-gen-liquid"  >https://www.npmjs.com/package/swagger-code-gen-liquid<img class="icon" src="../../img/link.svg" /></a></p>
</section>
<h2 id="#npm的相对地址和绝对地址">
    npm的相对地址和绝对地址
    <a class="anchor" name="npm的相对地址和绝对地址" href="#npm%e7%9a%84%e7%9b%b8%e5%af%b9%e5%9c%b0%e5%9d%80%e5%92%8c%e7%bb%9d%e5%af%b9%e5%9c%b0%e5%9d%80">#</a>
</h2>
<section id="#npm的相对地址和绝对地址"><p>在npm的包里，使用 ./template/index.liquid 文件时， 当调用方解析该文件地址，是依照调用方的相对路径来解析的， 那就需要调用方存在该模板文件。 解决方法是，在npm源文件里的调用使用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./template/service.liquid&#39;</span><span class="p">)</span></span></span></code></pre></div><p>如此，在包里，则会使用包里自带的模板文件。</p>
</section>
<h1 id="#杂项">
    杂项
    <a class="anchor" name="杂项" href="#%e6%9d%82%e9%a1%b9">#</a>
</h1>
<section id="#杂项"></section>
<h2 id="#gitignore重新添加">
    gitignore重新添加
    <a class="anchor" name="gitignore重新添加" href="#gitignore%e9%87%8d%e6%96%b0%e6%b7%bb%e5%8a%a0">#</a>
</h2>
<section id="#gitignore重新添加"><p>使用下面的命令把已经添加到仓库的缓存文件都删除。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> git rm -r --cached .</span></span></code></pre></div><p>修改或添加自己的gitignore 文件，然后重新 git add和提交即可。</p>
</section>
</article>
<script src="https://giscus.app/client.js"
        data-repo="yuzhigang/yuzhigang.github.io"
        data-repo-id="R_kgDOLqDc5Q"
        data-category="Announcements"
        data-category-id="DIC_kwDOLqDc5c4CeeJ5"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script><div class="float-panel mobile-only blur" style="display:none">
  <button type="button" class="sidebar-toggle" onclick="float_panel_click()">
    <svg class="icon" style="width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301">
      <path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path>
      <path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path>
    </svg>
  </button>
  <script>
    float_panel_click = () => {
      document.getElementById("start").classList.toggle("mobile");
      document.getElementsByClassName("sidebar-toggle")[0].classList.toggle("mobile");
    }
  </script>
</div></main>
    </div>
</body><script src="../../scripts/tableOfContents.js"></script>

<script type="text/javascript" src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.9/MathJax.js" defer></script>




<script src="../../scripts/mathjax.js"></script>
</html>